<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›Œí”„ìŠ¤íƒ€ ì½˜í…ì¸  í¬ë¦¬ì—ì´í„° - ê´€ë¦¬ì í˜ì´ì§€</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .admin-header {
            background-color: #333;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .admin-logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        .logo-dot {
            color: #8A4FFF;
            font-size: 28px;
            margin-right: 8px;
        }
        .admin-title {
            margin: 20px 0;
            color: #333;
        }
        .admin-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .admin-card h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .user-list {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .user-list th, .user-list td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        .user-list th {
            background-color: #f9f9f9;
        }
        .user-list tr:hover {
            background-color: #f5f5f5;
        }
        .vip-tag {
            background-color: #8A4FFF;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        .action-button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .vip-button {
            background-color: #8A4FFF;
            color: white;
        }
        .delete-button {
            background-color: #E84855;
            color: white;
        }
        .back-button {
            padding: 8px 15px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .message {
            padding: 10px 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="admin-logo">
            <span class="logo-dot">ğŸŸ£</span>
            <span>ì›Œí”„ìŠ¤íƒ€ Content Creator</span>
        </div>
        <button class="back-button" onclick="goBack()">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <div class="admin-container">
        <h1 class="admin-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
        
        <div id="message-container"></div>

        <div class="admin-card">
            <h2>ì‚¬ìš©ì ê´€ë¦¬</h2>
            <table class="user-list" id="user-table">
                <thead>
                    <tr>
                        <th>ì•„ì´ë””</th>
                        <th>ê°€ì…ì¼</th>
                        <th>ë©¤ë²„ì‹­ ìƒíƒœ</th>
                        <th>VIP ë§Œë£Œì¼</th>
                        <th>ìƒíƒœ</th>
                        <th>ì•¡ì…˜</th>
                    </tr>
                </thead>
                <tbody id="user-list-body">
                    <!-- ì‚¬ìš©ì ëª©ë¡ì´ JavaScriptë¡œ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                </tbody>
            </table>
        </div>

        <div class="admin-card">
            <h2>í†µê³„</h2>
            <div style="display: flex; justify-content: space-between; flex-wrap: wrap;">
                <div style="min-width: 200px; margin-bottom: 15px;">
                    <strong>ì´ ì‚¬ìš©ì:</strong> <span id="total-users">0</span>
                </div>
                <div style="min-width: 200px; margin-bottom: 15px;">
                    <strong>VIP ì‚¬ìš©ì:</strong> <span id="vip-users">0</span>
                </div>
                <div style="min-width: 200px; margin-bottom: 15px;">
                    <strong>ì˜¤ëŠ˜ ìƒì„±ëœ ì½˜í…ì¸ :</strong> <span id="contents-today">0</span>
                </div>
                <div style="min-width: 200px; margin-bottom: 15px;">
                    <strong>ì´ ì½˜í…ì¸  ìƒì„±ìˆ˜:</strong> <span id="total-contents">0</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        function goBack() {
            window.location.href = "/";
        }

        // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showMessage(text, type) {
            const messageContainer = document.getElementById('message-container');
            const messageElement = document.createElement('div');
            messageElement.className = `message ${type}`;
            messageElement.textContent = text;
            messageContainer.appendChild(messageElement);
            
            // ìë™ ì œê±°
            setTimeout(() => {
                messageElement.style.opacity = '0';
                messageElement.style.transition = 'opacity 0.5s';
                setTimeout(() => messageContainer.removeChild(messageElement), 500);
            }, 4000);
        }

        // VIP ìƒíƒœ ë³€ê²½ í•¨ìˆ˜
        function changeVipStatus(username, makeVip) {
            try {
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const users = JSON.parse(localStorage.getItem('smart_content_users') || '[]');
                const userIndex = users.findIndex(user => user.username === username);
                
                if (userIndex === -1) {
                    showMessage(`ì‚¬ìš©ì '${username}'ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`, 'error');
                    return;
                }
                
                // VIP ìƒíƒœ ë³€ê²½
                if (makeVip) {
                    // VIPë¡œ ì—…ê·¸ë ˆì´ë“œ
                    const today = new Date();
                    const expiryDate = new Date(today);
                    expiryDate.setDate(today.getDate() + 30); // 30ì¼ í›„
                    
                    users[userIndex].membershipType = 'vip';
                    users[userIndex].vipStatus = 'approved';
                    users[userIndex].membershipExpiry = expiryDate.toISOString();
                    users[userIndex].updatedAt = new Date().toISOString();
                    
                    showMessage(`ì‚¬ìš©ì '${username}'ê°€ VIPë¡œ ì—…ê·¸ë ˆì´ë“œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                } else {
                    // VIP ì œê±°
                    users[userIndex].membershipType = 'basic';
                    users[userIndex].vipStatus = 'none';
                    users[userIndex].membershipExpiry = null;
                    users[userIndex].updatedAt = new Date().toISOString();
                    
                    showMessage(`ì‚¬ìš©ì '${username}'ì˜ VIP ê¶Œí•œì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                }
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸
                localStorage.setItem('smart_content_users', JSON.stringify(users));
                
                // í…Œì´ë¸” ë‹¤ì‹œ ë¡œë“œ
                loadUsers();
            } catch (error) {
                console.error('VIP ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜:', error);
                showMessage('VIP ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ì‚¬ìš©ì ì‚­ì œ í•¨ìˆ˜
        function deleteUser(username) {
            if (confirm(`ì •ë§ë¡œ ì‚¬ìš©ì '${username}'ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                try {
                    // ê´€ë¦¬ìëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŒ
                    if (username === '1111') {
                        showMessage('ê´€ë¦¬ì ê³„ì •ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                        return;
                    }
                    
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    const users = JSON.parse(localStorage.getItem('smart_content_users') || '[]');
                    const filteredUsers = users.filter(user => user.username !== username);
                    
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸
                    localStorage.setItem('smart_content_users', JSON.stringify(filteredUsers));
                    
                    showMessage(`ì‚¬ìš©ì '${username}'ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                    
                    // í…Œì´ë¸” ë‹¤ì‹œ ë¡œë“œ
                    loadUsers();
                } catch (error) {
                    console.error('ì‚¬ìš©ì ì‚­ì œ ì¤‘ ì˜¤ë¥˜:', error);
                    showMessage('ì‚¬ìš©ì ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }
        }
        
        // ì‚¬ìš©ì ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadUsers() {
            const userListBody = document.getElementById('user-list-body');
            userListBody.innerHTML = '';
            
            try {
                const users = JSON.parse(localStorage.getItem('smart_content_users') || '[]');
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                document.getElementById('total-users').textContent = users.length;
                document.getElementById('vip-users').textContent = users.filter(user => 
                    user.membershipType === 'vip' && user.vipStatus === 'approved'
                ).length;
                
                // ì½˜í…ì¸  í†µê³„ëŠ” ë”ë¯¸ ë°ì´í„° ì‚¬ìš©
                document.getElementById('contents-today').textContent = Math.floor(Math.random() * 20);
                document.getElementById('total-contents').textContent = Math.floor(Math.random() * 200) + 50;
                
                // ì‚¬ìš©ì ëª©ë¡ì´ ë¹„ì–´ìˆëŠ” ê²½ìš°
                if (users.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="6" style="text-align: center;">ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</td>`;
                    userListBody.appendChild(row);
                    return;
                }
                
                // ê° ì‚¬ìš©ì í–‰ ìƒì„±
                users.forEach(user => {
                    const isVip = user.membershipType === 'vip' && user.vipStatus === 'approved';
                    const row = document.createElement('tr');
                    
                    // VIP ë§Œë£Œì¼ ê³„ì‚°
                    let expiryText = '-';
                    if (isVip && user.membershipExpiry) {
                        const expiryDate = new Date(user.membershipExpiry);
                        expiryText = expiryDate.toLocaleDateString();
                    }
                    
                    // ê°€ì…ì¼ ê³„ì‚°
                    let createdAtText = 'ì•Œ ìˆ˜ ì—†ìŒ';
                    if (user.createdAt) {
                        createdAtText = new Date(user.createdAt).toLocaleDateString();
                    }
                    
                    row.innerHTML = `
                        <td>${user.username}</td>
                        <td>${createdAtText}</td>
                        <td>${isVip ? '<span class="vip-tag">VIP</span>' : 'ì¼ë°˜íšŒì›'}</td>
                        <td>${expiryText}</td>
                        <td>${user.vipStatus === 'pending' ? 'ìŠ¹ì¸ ëŒ€ê¸°ì¤‘' : '-'}</td>
                        <td>
                            ${isVip 
                                ? `<button class="action-button delete-button" onclick="changeVipStatus('${user.username}', false)">VIP í•´ì œ</button>`
                                : `<button class="action-button vip-button" onclick="changeVipStatus('${user.username}', true)">VIP ë¶€ì—¬</button>`
                            }
                            <button class="action-button delete-button" onclick="deleteUser('${user.username}')">ì‚­ì œ</button>
                        </td>
                    `;
                    
                    userListBody.appendChild(row);
                });
            } catch (error) {
                console.error('ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                showMessage('ì‚¬ìš©ì ëª©ë¡ì„ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" style="text-align: center; color: red;">ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td>`;
                userListBody.appendChild(row);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('load', () => {
            loadUsers();
            showMessage('ê´€ë¦¬ì í˜ì´ì§€ì— ì ‘ì†í–ˆìŠµë‹ˆë‹¤.', 'info');
        });
    </script>
</body>
</html>
